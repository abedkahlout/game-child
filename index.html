<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ 2030</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚ */
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #E0F7FA;
            margin: 0; padding: 10px;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; text-align: center;
        }
        .container {
            background: #ffffff; width: 100%; max-width: 450px;
            padding: 20px; border-radius: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); border: 4px solid #fff;
        }
        .btn-primary {
            background: linear-gradient(180deg, #4CAF50 0%, #2E7D32 100%);
            color: white; padding: 15px; font-size: 1.2rem;
            border-radius: 50px; border: none; width: 100%; margin-top: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); cursor: pointer;
        }
        .input-field {
            width: 100%; padding: 15px; border: 2px solid #ddd;
            border-radius: 15px; font-size: 1.1rem; text-align: center;
            background: #f9f9f9; box-sizing: border-box; font-family: 'Cairo';
        }
        .region-btn {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; margin: 12px 0; padding: 15px 20px;
            font-size: 1.1rem; border-radius: 18px; border: none;
            font-weight: bold; cursor: pointer;
        }
        .region-open { background: white; color: #006C35; border: 2px solid #006C35; }
        .region-locked { background: #eee; color: #aaa; border: 2px solid #ddd; cursor: not-allowed; }
        .option-btn {
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            background: #FFF8E1; border: 2px solid #FFECB3; border-radius: 15px;
            font-size: 1.1rem; color: #333; font-family: 'Cairo'; font-weight: bold; cursor: pointer;
        }
        .screen { display: none; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: 0; } }
        .active { display: block; }
        .hearts { color: #F44336; letter-spacing: 2px; }
    </style>
</head>
<body>

<audio id="sound-correct" preload="auto" src="https://raw.githubusercontent.com/kurtextrem/simple-simon/master/sounds/green.mp3"></audio>
<audio id="sound-wrong" preload="auto" src="https://raw.githubusercontent.com/kurtextrem/simple-simon/master/sounds/wrong.mp3"></audio>
<audio id="sound-win" preload="auto" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<div class="container">
    <div id="login-screen" class="screen active">
        <div style="font-size: 60px;">ğŸ‡¸ğŸ‡¦</div>
        <h1>Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ 2030</h1>
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„ÙÙ…Ø© Ø§Ù„ØµØºÙŠØ±Ø©!</p>
        <input type="text" id="username" class="input-field" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§...">
        <button class="btn-primary" onclick="startGame()">ğŸš€ Ø§Ù†Ø·Ù„Ø§Ù‚ (ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª)</button>
    </div>

    <div id="map-screen" class="screen">
        <h3>ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ©</h3>
        <p id="player-display" style="color:#2E7D32; font-weight:bold;"></p>
        <div id="regions-container"></div>
        <p style="color:red; font-size:0.8rem; cursor:pointer; margin-top:20px;" onclick="resetData()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</p>
    </div>

    <div id="quiz-screen" class="screen">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span id="current-region-name" style="color:#006C35; font-weight:bold;"></span>
            <span class="hearts" id="attempts-count">â¤â¤â¤</span>
        </div>
        <p id="question-text" style="font-size: 1.2rem; font-weight: bold; margin: 20px 0;">...</p>
        <div id="options-container"></div>
        <p id="feedback-msg" style="font-weight:bold; height:20px;"></p>
        <button class="btn-primary" style="background:#888; margin-top:20px; font-size:1rem; padding:10px;" onclick="goBackToMap()">Ø§Ù†Ø³Ø­Ø§Ø¨</button>
    </div>

    <div id="finish-screen" class="screen">
        <div style="font-size: 80px;">ğŸ†</div>
        <h1 style="color:#FFC107;">Ù…Ø¨Ø±ÙˆÙƒ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²!</h1>
        <p>Ø£ØªÙ…Ù…ØªÙ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙˆØ·Ù†ÙŠ Ø¨Ù†Ø¬Ø§Ø­.</p>
        <button class="btn-primary" onclick="resetData()">Ø¨Ø¯Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    </div>
</div>

<script>
    /* --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª --- */
    const gameData = [
        { id: 1, name: "Ø§Ù„Ø±ÙŠØ§Ø¶", questions: [{ q: "Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù‡ÙŠØŸ", options: ["Ø¬Ø¯Ø©", "Ø§Ù„Ø±ÙŠØ§Ø¶", "Ø§Ù„Ø¯Ù…Ø§Ù…"], correct: 1 }, { q: "Ù…Ø´Ø±ÙˆØ¹ ØªØ±ÙÙŠÙ‡ÙŠ Ø¶Ø®Ù… ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶ØŸ", options: ["Ø§Ù„Ù‚Ø¯ÙŠØ©", "Ù†ÙŠÙˆÙ…", "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±"], correct: 0 }] },
        { id: 2, name: "Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©", questions: [{ q: "ÙŠÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ø­Ø±Ø§Ù… ÙÙŠØŸ", options: ["Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", "Ù…ÙƒØ©", "Ø§Ù„Ø·Ø§Ø¦Ù"], correct: 1 }] },
        { id: 3, name: "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", questions: [{ q: "ØªØ´ØªÙ‡Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø¨Ù€ØŸ", options: ["Ø§Ù„Ù†ÙØ·", "Ø§Ù„Ø²Ø±Ø§Ø¹Ø©", "Ø§Ù„Ø¬Ø¨Ø§Ù„"], correct: 0 }] },
        { id: 4, name: "Ø§Ù„Ø´Ù…Ø§Ù„", questions: [{ q: "ØªÙ‚Ø¹ Ù…Ø¯Ø§Ø¦Ù† ØµØ§Ù„Ø­ ÙÙŠØŸ", options: ["Ø§Ù„Ø¹Ù„Ø§", "ØªØ¨ÙˆÙƒ", "Ø§Ù„Ø¬ÙˆÙ"], correct: 0 }] },
        { id: 5, name: "Ø§Ù„Ø¬Ù†ÙˆØ¨", questions: [{ q: "Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¶Ø¨Ø§Ø¨ Ù‡ÙŠØŸ", options: ["Ø£Ø¨Ù‡Ø§", "Ø¬Ø§Ø²Ø§Ù†", "Ù†Ø¬Ø±Ø§Ù†"], correct: 0 }] }
    ];

    let playerName = "", unlockedLevel = 1, currentRegionIndex = 0, currentQuestionIndex = 0, attempts = 3;

    // --- Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø­Ø±ÙŠ Ù„Ù„Ø£ØµÙˆØ§Øª ---
    // Ø¯Ø§Ù„Ø© Ù„ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø£ØµÙˆØ§Øª Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¶ØºØ·Ø©
    function initAudio() {
        const audioIds = ['sound-correct', 'sound-wrong', 'sound-win'];
        audioIds.forEach(id => {
            const audio = document.getElementById(id);
            audio.volume = 0; // ØµÙˆØª Ù…ÙƒØªÙˆÙ…
            audio.play().then(() => {
                audio.pause(); // Ø¥ÙŠÙ‚Ø§Ù ÙÙˆØ±ÙŠ
                audio.currentTime = 0; // Ø¥Ø¹Ø§Ø¯Ø© Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
                audio.volume = 1; // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª
            }).catch(e => console.log("Audio waiting for interaction"));
        });
    }

    function playAudio(id) {
        const audio = document.getElementById(id);
        audio.currentTime = 0;
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
        const playPromise = audio.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.log("Audio play prevented:", error);
            });
        }
    }

    window.onload = function() {
        if(localStorage.getItem('saudiPath_name')) {
            playerName = localStorage.getItem('saudiPath_name');
            unlockedLevel = parseInt(localStorage.getItem('saudiPath_level') || 1);
            showScreen('map-screen'); renderMap();
        }
    };

    function startGame() {
        const name = document.getElementById('username').value;
        if(!name) return alert("Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù…Ùƒ!");
        
        // Ù‡Ù†Ø§ Ù†Ù‚ÙˆÙ… Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª
        initAudio();

        playerName = name;
        localStorage.setItem('saudiPath_name', name);
        localStorage.setItem('saudiPath_level', 1);
        showScreen('map-screen'); renderMap();
    }

    // --- Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ ---

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'map-screen') document.getElementById('player-display').innerText = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…Ø©: ${playerName}`;
    }

    function renderMap() {
        const container = document.getElementById('regions-container'); container.innerHTML = "";
        gameData.forEach((r, i) => {
            const btn = document.createElement('button');
            const isOpen = (i + 1) <= unlockedLevel;
            btn.className = `region-btn ${isOpen ? 'region-open' : 'region-locked'}`;
            btn.innerHTML = `<span>${r.name}</span><span>${isOpen ? 'ğŸ”“' : 'ğŸ”’'}</span>`;
            btn.disabled = !isOpen;
            if(isOpen) btn.onclick = () => openRegion(i);
            container.appendChild(btn);
        });
        if(unlockedLevel > gameData.length) { 
            setTimeout(()=> playAudio('sound-win'), 500);
            showScreen('finish-screen'); 
        }
    }

    function openRegion(idx) {
        currentRegionIndex = idx; currentQuestionIndex = 0; attempts = 3;
        document.getElementById('current-region-name').innerText = gameData[idx].name;
        updateHearts(); loadQuestion(); showScreen('quiz-screen');
    }

    function loadQuestion() {
        if(currentQuestionIndex >= gameData[currentRegionIndex].questions.length) {
            if(currentRegionIndex + 2 > unlockedLevel) {
                unlockedLevel = currentRegionIndex + 2;
                localStorage.setItem('saudiPath_level', unlockedLevel);
            }
            alert("Ø£Ø­Ø³Ù†ØªÙ! ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ğŸ‰");
            renderMap(); showScreen('map-screen'); return;
        }
        const q = gameData[currentRegionIndex].questions[currentQuestionIndex];
        document.getElementById('question-text').innerText = q.q;
        document.getElementById('feedback-msg').innerText = "";
        const optsDiv = document.getElementById('options-container'); optsDiv.innerHTML = "";
        q.options.forEach((opt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn'; btn.innerText = opt;
            btn.onclick = () => checkAnswer(i, btn);
            optsDiv.appendChild(btn);
        });
    }

    function checkAnswer(idx, btn) {
        const correct = gameData[currentRegionIndex].questions[currentQuestionIndex].correct;
        const feedback = document.getElementById('feedback-msg');
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);

        if(idx === correct) {
            playAudio('sound-correct'); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
            btn.style.background = "#C8E6C9"; btn.style.borderColor = "green";
            feedback.style.color = "green"; feedback.innerText = "Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ…";
            setTimeout(() => { currentQuestionIndex++; loadQuestion(); }, 1000);
        } else {
            playAudio('sound-wrong'); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
            attempts--; updateHearts();
            btn.style.background = "#FFCDD2"; btn.style.borderColor = "red";
            feedback.style.color = "red"; feedback.innerText = "Ø®Ø·Ø£! Ø­Ø§ÙˆÙ„ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ âŒ";
            setTimeout(() => {
                if(attempts > 0) {
                    feedback.innerText = "";
                    document.querySelectorAll('.option-btn').forEach(b => b.disabled = false);
                } else {
                    alert("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª! Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø±ÙŠØ·Ø©."); renderMap(); showScreen('map-screen');
                }
            }, 1000);
        }
    }

    function updateHearts() { document.getElementById('attempts-count').innerText = "â¤".repeat(attempts); }
    function goBackToMap() { renderMap(); showScreen('map-screen'); }
    function resetData() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>